<!-- templates/admin/password_form.html -->
{% extends "base.html" %}
{% block title %}{{ title or "Alterar senha" }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-3">
    {{ title or ("Alterar senha ‚Äì " ~ (user.name or user.username or user.id)) }}
  </h2>

  {# Mensagens #}
  {% if success %}
    <div class="alert alert-success">{{ success }}</div>
  {% endif %}
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}
  {% if errors and errors|length %}
    <div class="alert alert-danger">
      <ul class="mb-0">
        {% for e in errors %}<li>{{ e }}</li>{% endfor %}
      </ul>
    </div>
  {% endif %}

  <form method="post" action="/admin/users/{{ user.id }}/senha" novalidate>
    {# Se o backend passar "next" no contexto, preserva #}
    {% if next %}
      <input type="hidden" name="next" value="{{ next }}">
    {% endif %}

    <div class="mb-3">
      <label class="form-label" for="password">Nova senha</label>
      <div class="input-group">
        <input
          type="password"
          id="password"
          name="password"
          class="form-control"
          required
          minlength="6"
          autocomplete="new-password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        <button class="btn btn-outline-secondary" type="button" id="togglePwd1" aria-label="Mostrar/ocultar senha">
          <span class="d-none d-sm-inline">Mostrar</span>
          <span class="d-inline d-sm-none">üëÅ</span>
        </button>
      </div>
      <div class="form-text">M√≠nimo de 6 caracteres.</div>
    </div>

    <div class="mb-3">
      <label class="form-label" for="password_confirm">Confirmar nova senha</label>
      <div class="input-group">
        <input
          type="password"
          id="password_confirm"
          name="password_confirm"
          class="form-control"
          required
          minlength="6"
          autocomplete="new-password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        <button class="btn btn-outline-secondary" type="button" id="togglePwd2" aria-label="Mostrar/ocultar senha">
          <span class="d-none d-sm-inline">Mostrar</span>
          <span class="d-inline d-sm-none">üëÅ</span>
        </button>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary">Salvar</button>
      <a href="/admin/users" class="btn btn-outline-secondary">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function () {
    function toggle(btnId, inputId) {
      const btn = document.getElementById(btnId);
      const input = document.getElementById(inputId);
      if (!btn || !input) return;
      btn.addEventListener('click', function () {
        input.type = input.type === 'password' ? 'text' : 'password';
        const spans = btn.querySelectorAll('span');
        spans.forEach(s => {
          if (s.classList.contains('d-none')) s.classList.remove('d-none');
          else if (s.classList.contains('d-sm-inline')) s.classList.toggle('d-none');
        });
      });
    }
    toggle('togglePwd1', 'password');
    toggle('togglePwd2', 'password_confirm');
  })();
</script>
{% endblock %}
